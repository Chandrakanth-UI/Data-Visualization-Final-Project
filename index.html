<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Remote Work Revolution — Data Science Salaries (2020–2023)</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 20px;
      background: #f5f8fc;
      color: #111;
    }
    header {
      margin-bottom: 15px;
    }
    h1 {
      font-size: 22px;
      margin: 0;
    }
    .small {
      font-size: 13px;
      color: #555;
    }
    #container {
      display: grid;
      gap: 16px;
    }
    .row {
      display: grid;
      gap: 16px;
    }
    @media (min-width: 1100px) {
      .row.two {
        grid-template-columns: 1fr 1fr;
      }
    }
    .card {
      background: white;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }
    .plot {
      width: 100%;
      height: 450px;
    }
    footer {
      text-align: center;
      margin-top: 20px;
      font-size: 12px;
      color: #777;
    }
  </style>
</head>
<body>
  <header>
    <h1 style="text-align: center;">The Remote Work Revolution — Data Science Salaries (2020–2023)</h1>
    <p class="small" style="text-align: center;">
  Dataset: <code>ds_salaries.csv</code> must be in the same folder as this HTML file.
</p>

<p id="summary" class="small" style="text-align: center;">
  Loading dataset...
</p>
  </header>

  <div id="container">
    <div class="row two">
      <div class="card">
        <h3>Salary Distribution by Work Type (per Year)</h3>
        <div id="viz1" class="plot"></div>
        <p class="small">Box plots compare salary distributions for Remote, Hybrid, and Onsite jobs across years.</p>
      </div>
      <div class="card">
        <h3>Work Type Proportions & Average Salary Trends</h3>
        <div id="viz2" class="plot"></div>
        <p class="small">Stacked area shows work type proportions each year, with dashed lines for average salaries.</p>
      </div>
    </div>

    <div class="row two">
      <div class="card">
        <h3>Feature Correlations & Salary vs Experience</h3>
        <div id="viz3_heatmap" style="height:380px;"></div>
        <div id="viz3_scatter" style="height:360px; margin-top:10px;"></div>
      </div>
      <div class="card">
        <h3>Top 10 Extreme Salaries (Annotated)</h3>
        <div id="viz4" class="plot"></div>
        <p class="small">Shows top 10 highest-paid data science roles with hover details.</p>
      </div>
    </div>
  </div>

  <footer>
    © 2025 Remote Work Salary Dashboard — Built with Plotly.js
  </footer>

<script>
/* Coloumn Mapping */
const COLS = {
  year: 'work_year',
  salary: 'salary_in_usd',
  remote_ratio: 'remote_ratio',
  exp: 'experience_level',
  job: 'job_title',
  country: 'company_location'
};


function mapRemoteRatio(val) {
  const n = Number(val);
  if (n === 100) return 'Remote';
  if (n === 50) return 'Hybrid';
  if (n === 0) return 'Onsite';
  return 'Unknown';
}
const expMap = { EN: 0, MI: 1, SE: 2, EX: 3 };

/* Loading the dataset */
fetch("ds_salaries.csv")
  .then(res => res.text())
  .then(csvText => {
    const data = Papa.parse(csvText, { header: true, skipEmptyLines: true }).data;
    processAndRender(data);
  })
  .catch(err => {
    document.getElementById("summary").innerHTML =
      "❌ Could not load ds_salaries.csv — ensure it’s in the same folder.";
    console.error(err);
  });

  
/* main process */
function processAndRender(raw) {
  const rows = raw.map(r => ({
    year: Number(r[COLS.year]),
    salary: Number(r[COLS.salary]),
    work_type: mapRemoteRatio(r[COLS.remote_ratio]),
    exp: r[COLS.exp],
    exp_code: expMap[r[COLS.exp]] ?? null,
    job: r[COLS.job],
    country: r[COLS.country]
  })).filter(r => r.year && r.salary && r.work_type !== 'Unknown');

  const years = [...new Set(rows.map(r => r.year))].sort();
  document.getElementById("summary").innerHTML =
    `<strong>Loaded:</strong> ${rows.length} rows | Years: ${years.join(", ")} | Work types: ${[...new Set(rows.map(r => r.work_type))].join(", ")}`;

  renderViz1(rows, years);
  renderViz2(rows, years);
  renderViz3(rows);
  renderViz4(rows);
}

/* ----- Viz1: Salary Distribution ----- */
function renderViz1(rows, years) {
  const workTypes_viz1 = ['Remote', 'Hybrid', 'Onsite']; // renamed to avoid conflict

  
  const allTraces = [];
  years.forEach((yr, i) => {
    workTypes_viz1.forEach(wt => {
      allTraces.push({
        y: rows.filter(r => r.year === yr && r.work_type === wt).map(r => r.salary),
        x: Array(rows.filter(r => r.year === yr && r.work_type === wt).length).fill(wt),
        name: wt,
        type: 'box',
        visible: i === 0, // Only show first year by default
        boxpoints: 'outliers',
        marker: { opacity: 0.7 },
        line: { width: 1 },
      });
    });
  });

  

  // Define dropdown steps
  const steps = years.map((yr, yearIndex) => {
    const visibilityArray = allTraces.map((_, i) => {
      const group = Math.floor(i / 3); // each year has 3 traces
      return group === yearIndex;      // only show the selected year group
    });

    return {
      label: yr.toString(),
      method: "update",
      args: [
        { visible: visibilityArray },
        { title: `Salary Distribution — ${yr}` }
      ]
    };
  });

  const layout_viz1 = {
    title: `Salary Distribution — ${years[0]}`,
    yaxis: { title: 'Salary (USD)' },
    boxmode: 'group',
    legend: {
      x: 1.05,
      y: 1,
      xanchor: 'left',
    },
    updatemenus: [{
      buttons: steps,
      direction: "down",
      showactive: true,
      x: 1.05,
      xanchor: "left",
      y: 1.2,
      yanchor: "top"
    }],
    margin: { t: 100, l: 60, r: 150, b: 60 }
  };

  Plotly.newPlot('viz1', allTraces, layout_viz1, { responsive: true });
}



/* ----- Viz2: Work Type Proportion & Avg Salary ----- */
function renderViz2(rows, years) {
  const workTypes = ['Remote', 'Hybrid', 'Onsite'];
  const counts = {}, avg = {};
  years.forEach(y => {
    const yrRows = rows.filter(r => r.year === y);
    counts[y] = {}; avg[y] = {};
    workTypes.forEach(w => {
      const subset = yrRows.filter(r => r.work_type === w);
      counts[y][w] = subset.length;
      avg[y][w] = subset.length ? subset.reduce((a,b)=>a+b.salary,0)/subset.length : 0;
    });
  });

  const totals = y => workTypes.reduce((s, w) => s + counts[y][w], 0);
  const yearsArr = years;
  const propTraces = workTypes.map(w => ({
    x: yearsArr,
    y: yearsArr.map(y => counts[y][w] / totals(y)),
    stackgroup: 'one',
    name: w,
    fill: 'tonexty',
    hovertemplate: '%{y:.0%} '+w+'<extra></extra>'
  }));

  const avgTraces = workTypes.map(w => ({
    x: yearsArr,
    y: yearsArr.map(y => avg[y][w]),
    yaxis: 'y2',
    name: `${w} Avg Salary`,
    mode: 'lines+markers',
    line: { dash: 'dash', width: 2 }
  }));

  const layout = {
    title: 'Work Type Proportions & Average Salary Trends (2020–2023)',
    xaxis: { title: 'Year' },
    yaxis: { title: 'Proportion', tickformat: '.0%', range: [0, 1] },
    yaxis2: { title: 'Average Salary (USD)', overlaying: 'y', side: 'right' },
    legend: { orientation: 'h', y: -0.2 },
    margin: { t: 60, l: 60, r: 60, b: 80 }
  };

  Plotly.newPlot('viz2', [...propTraces, ...avgTraces], layout, { responsive: true });
}

/* ----- Viz3: Correlation + Scatter ----- */
function renderViz3(rows) {
  const workMap = { 'Remote': 2, 'Hybrid': 1, 'Onsite': 0 };
  const table = rows.map(r => ({
    salary: r.salary,
    exp_code: r.exp_code ?? -1,
    work_code: workMap[r.work_type]
  }));
  const cols = ['salary', 'exp_code', 'work_code'];
  const mean = c => table.reduce((s, r) => s + r[c], 0) / table.length;
  const std = c => Math.sqrt(table.reduce((s, r) => s + Math.pow(r[c] - mean(c), 2), 0) / (table.length - 1));
  const cov = (a, b) => table.reduce((s, r) => s + (r[a] - mean(a)) * (r[b] - mean(b)), 0) / (table.length - 1);
  const corr = cols.map(a => cols.map(b => cov(a, b) / (std(a) * std(b))));

  Plotly.newPlot('viz3_heatmap', [{
    z: corr, x: cols, y: cols, type: 'heatmap', colorscale: 'RdBu', zmid: 0
  }], {
    title: 'Correlation Heatmap (Salary vs Encoded Features)',
    margin: { t: 60, l: 60, r: 20, b: 60 }
  });

  const scatter = ['Remote', 'Hybrid', 'Onsite'].map(t => ({
    x: rows.filter(r => r.work_type === t).map(r => r.exp_code),
    y: rows.filter(r => r.work_type === t).map(r => r.salary),
    mode: 'markers',
    name: t,
    marker: { size: 8, opacity: 0.7 }
  }));

  Plotly.newPlot('viz3_scatter', scatter, {
    title: 'Salary vs Experience Level (by Work Type)',
    xaxis: { title: 'Experience (0=EN, 1=MI, 2=SE, 3=EX)' },
    yaxis: { title: 'Salary (USD)' },
    margin: { t: 60, l: 60, r: 20, b: 60 }
  });
}

/* ----- Viz4: Top Earners ----- */
function renderViz4(rows) {
  const top = rows.sort((a,b)=>b.salary-a.salary).slice(0,10);
  const names = top.map(r => `${r.job} (${r.country})`);
  const salaries = top.map(r => r.salary);
  const texts = top.map(r => `${r.work_type} | ${r.exp} | $${r.salary.toLocaleString()}`);

  Plotly.newPlot('viz4', [{
    x: salaries.reverse(),
    y: names.reverse(),
    text: texts.reverse(),
    orientation: 'h',
    type: 'bar',
    hoverinfo: 'text',
    marker: { color: '#0077b6', opacity: 0.8 }
  }], {
    title: 'Top 10 Highest Salaries',
    margin: { l: 260, t: 60 },
    xaxis: { title: 'Salary (USD)' }
  });
}
</script>
</body>
</html>
